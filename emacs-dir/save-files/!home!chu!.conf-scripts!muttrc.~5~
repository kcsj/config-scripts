# =================================
# custom .muttrc file
# Matthew Ball (copyleft 2008-2011)
# =================================
# TODO: create separate config files in ~/.conf-scripts/mutt-dir/ and source the files here
# Example: variables, accounts (university, gmail), bindings, colours, etc.

# ================
# personal details
# ================
set realname = "Matthew Ball"
set editor = "emacsclient %s" # edit messages with emacs

# =================
# process passwords
# =================
set my_tmp = `gpg -o ~/.conf-scripts/passwords/.tmp -d ~/.conf-scripts/passwords/.passwd.gpg`
set my_gmail_pass = `awk '/GMail:/ {print $2}' ~/.conf-scripts/passwords/.tmp`
set my_anu_pass = `awk '/ANU:/ {print $2}' ~/.conf-scripts/passwords/.tmp`
set my_del = `rm -f ~/.conf-scripts/passwords/.tmp`

# =========
# variables
# =========
set my_muttrc = "~/.muttrc" # path to configuration file
set my_manual = "/usr/share/doc/mutt/manual.txt.gz" # path to mutt manual

# ====================
# system configuration
# ====================
set ssl_ca_certificates_file="/etc/ssl/certs/ca-certificates.crt" # system-wide CA file managed by the ca-certificates package

unset help # turn off menu bar
set markers # mark wrapped lines of text in the pager with a +
set smart_wrap # don't wrap mid-word
set pager_context=5 # retain 5 lines of previous page when scrolling
set pager_index_lines= 5 # how large is the index window
# push <show-version> # shows mutt version at startup
# push <toggle-mailboxes> # open mutt to select mailbox

# ============
# folder hooks
# ============
folder-hook . "set sort=threads" # sort by threads (keep threads together)
folder-hook . "set sort_aux=last-date-received" # sort secondarily by last date received
# folder-hook . "push '<collapse-all>'" # collapse all threads
folder-hook . "push '<last-entry>'" # move to the most recent (i.e. last) message

# customise how various features appear
folder-hook . "set index_format='%3C: [%Z, %N, %2M] %-88.84s [ %-25.25F] (%{%d %b %Y})'"
# folder-hook . "set index_format='%5C. [%Z, %N, %2M] %-84.84s [ %-25.25F ] (%{Date: %d %b}) (%l)'"
# folder-hook . "set status_format='--[[ %f ]]--[[ New:%n Old:%o Del:%d Post:%p ]]--(%s/%S)--[%V]--%>-(%P)---'"
# folder-hook . "set pager_format='--[[ %C/%m ]]--( %-30.30n )--\> %s \<----%>-(%P)---'"

# ===============
# account details
# ===============
# alternates "(mathew.ball@gmail\.com)|(u4537508@anu\.edu\.au)"

# account-hook . 'unset imap_user imap_pass' # clear accounts (make selection)
# account-hook 'imaps://mathew.ball@gmail.com/' "set imap_user=mathew.ball imap_pass=$my_gmail_pass" # gmail account
# account-hook 'imaps://u4537508@imap.anu.edu.au/' "set imap_user=u4537508 imap_pass=$my_anu_pass" # university account

# set folder="imaps://mathew.ball@imap.gmail.com/" # gmail account ...
# mailboxes =INBOX =[Gmail]/Drafts =[Gmail]/'Sent Mail' =[Gmail]/Spam
# folder-hook 'imaps://mathew.ball@imap.gmail.com' " \
# 	    set folder=imaps://mathew.ball@imap.gmail.com/ \
# 	    postponted=+[Gmail]/Drafts \
# 	    record=+[Gmail]/'Sent Mail' \
# 	    smtp_url=smtps://mathew.ball@smtp.gmail.com \
# 	    smtp_pass=$my_pass1 \
# 	    from='Matthew Ball <mathew.ball@gmail.com> ' "

# set folder ="imaps://u4537508@imap.anu.edu.au/" # university account ...
# mailboxes =INBOX =Drafts =Sent =Spam
# folder-hook 'imaps://u4537508@imap.anu.edu.au/' " \
# 	    setfolder=imaps://u4537508@imap.anu.edu.au/ \
# 	    postponed=+Drafts \
# 	    record=+Sent \
# 	    smtp_url=smtp://smtphost.anu.edu.au \
# 	    from='Matthew Ball <u4537508@anu.edu.au> ' \ "

# ===================
# alias configuration
# ===================
set sort_alias=alias # sort aliases in alpha order by alias name

alias mwb Matthew Ball <mathew.ball@gmail.com>
alias djb Desmond Ball <desmond.ball@anu.edu.au>
alias ejo Elliot Osborne <crowbarjames@gmail.com>
alias lce Luke English <fourtyfour.saka@gmail.com>
alias jpc Joshua Chubb <chubb.jp@gmail.com>
alias lmd Liam Dunn <liam.dunn144@gmail.com>
# alias rww Robert Wall <robertlikesturtles@gmail.com>
alias rww Robert Wall <robert@rww.name>

# =============
# gmail details
# =============
# account settings ...
set imap_user = "mathew.ball@gmail.com"
set imap_pass=$my_gmail_pass
set smtp_url = "smtp://mathew.ball@smtp.gmail.com:587/"
set smtp_pass=$my_gmail_pass
set from = "mathew.ball@gmail.com"
# set realname = "Matthew Ball"

# general gmail ...
set folder = "imaps://imap.gmail.com:993"
set hostname = gmail.com
set postponed = "+[Gmail]/Drafts"
set record = "+[Gmail]/Sent Mail"
set trash = "imaps://imap.gmail.com/[Gmail]/Trash"
# set spoolfile = "+INBOX"
# set imap_check_subscribed
# set mail_check = 5
# set timeout = 100
# set imap_keepalive = 900
# set header_cache=~/.mutt/cache/headers
# set message_cachedir=~/.mutt/cache/bodies
# set certificate_file=~/.mutt/certificates
# set move = no
# set include
# set auto_tag = yes
# set edit_headers = yes

# general imap ...
set spoolfile = "+INBOX"
set imap_check_subscribed
set mail_check = 5
set timeout = 60 # check for mail every minute
set imap_keepalive = 900
set move = no
set include
set auto_tag = yes
set edit_headers = yes

set header_cache=~/.mutt/cache/headers
set message_cachedir=~/.mutt/cache/bodies
set certificate_file=~/.mutt/certificates

alternative_order text/plain text/html *
auto_view text/html

# ============
# header stuff
# ============
ignore "Authentication-Results:"
ignore "DomainKey-Signature:"
ignore "DKIM-Signature:"

# default list of header fields when displaying
ignore * # ignore all lines by default ...
unignore from: subject to cc date x-mailer x-url user-agent # ... then allow these through ...
hdr_order date from to cc subject # ... display the fields in this order

# =================
# keyboard bindings
# =================
macro index,pager gi "<change-folder>=INBOX<enter>" "go to inbox" # gmail style keyboard shortcuts ...
macro index,pager ga "<change-folder>=[Gmail]/All Mail<enter>" "go to all mail" # ...
macro index,pager gs "<change-folder>=[Gmail]/Sent Mail<enter>" "go to sent mail" # ...
macro index,pager tp "<change-folder>=[Gmail]/Important<enter>" "go to priority inbox" # ...
macro index,pager gd "<change-folder>=[Gmail]/Drafts<enter>" "go to drafts" # ...
macro index,pager S "<save-message>=[Gmail]/Spam<enter>" "mark message as spam" # spam keyboard shortcuts ...
macro index,pager H "<save-message>=INBOX<enter>" "mark message as ham (not spam)" # ...

macro index,pager y "<change-folder>?<toggle-mailboxes>" 'change current mailbox account' # change mailbox

# TODO: neither of these *really* works
# macro index <esc>1 "y8<return><return>" # change to ANU mailbox
# macro index <esc>2 "y10<return><return>" # change to gmail mailbox

# macro index q "<change-folder>?<toggle-mailboxes>" 'change from index to mailbox (browser view)' # change to mailbox view from index
# macro browser q "<exit><quit>" 'exit mutt from browser view' # exit mutt

# genius code to switch between active inbox
# macro index <F6> ":source ~/.mutt/university" # the file my university inbox is associated with
# macro index <F7> ":source ~/.mutt/gmail" # the file my gmail inbox is associated with

macro generic,index,pager,browser <f8> "<enter-command> exec what-key<enter>" 'display command executed by key-chord' # show command executed
macro generic,index,pager,browser <f9> "<enter-command> source $my_muttrc<enter>" 'reread configuration file' # reread configuration file
macro generic,index,pager,browser <f10> "<shell-escape> zcat $my_manual | sensible-pager<enter>" 'show mutt documentation' # show documentation

bind editor <space> noop
bind editor <Tab> complete-query
bind editor ^T complete

# *************
# default theme
# *************
# =============
# general stuff
# =============
# color header brightblue default "^date:"
# color header green default "^cc"
# color header brightblue default "^organi[sz]ation"
# color header brightblue default "^x-newsreader"
# color header brightblue default "^x-mailing-list"
# color header brightblue default "^posted-to"
# color header brightblue default "^message-id"
# color header cyan default "^user-agent"
# color header cyan default "^x-mailer"
# color header green default "^To:"
# color header brightyellow default "^subject"
# color header red default "^From:"

# color signature red default
# color tilde red default
# color attachment magenta default

# color quoted green default
# color quoted1 cyan default
# color quoted2 brightblue default
# color quoted3 blue default

# color body yellow default "(finger|ftp|http|https|news|telnet)://[^ >]*"
# color body yellow default "<URL:[^ ]*>"
# color body yellow default "www\\.[-.a-z0-9]+\\.[a-z][a-z][a-z]?([-_./~a-z0-9]+)?"
# color body yellow default "mailto: *[^ ]+\(\\i?subject=[^ ]+\)?"
# color body yellow default "[-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+"

# ======================
# highlight special text
# ======================
# color body brightwhite default "[^[:alnum:]][*_/][-_&!.,[:alnum:]]+[*_/][^[:alnum:]]" # *bold*
# color body brightwhite default "^[*_/][-_&!.,[:alnum:]]+[*_/][^[:alnum:]]" # _underlined_
# color body brightwhite default "^[*_/][-_&!.,[:alnum:]]+[*_/]$" # /italic/

# color tree red default

# ================
# inline pgp stuff
# ================
# color body magenta default "-----BEGIN PGP SIGNED MESSAGE-----"
# color body magenta default "-----BEGIN PGP SIGNATURE-----"
# color body magenta default "-----END PGP SIGNED MESSAGE-----"
# color body magenta default "-----END PGP SIGNATURE-----"

# color body brightyellow default "(^| )[;:8]-?[][)(PDp/|\]+($| )"
# color body brightyellow default "<[Bb]?[Gg]>"

# *************
# zenburn theme
# *************
# =============
# general stuff
# =============
color normal     color188 color237
color error      color115 color236
color markers    color142 color238
color tilde      color108 color237
color status     color144 color234

# ===========
# index stuff
# ===========
color indicator  color108 color236
color tree       color109 color237
color index      color188 color237 ~A
color index      color188 color237 ~N
color index      color188 color237 ~O
color index      color174 color237 ~F
color index      color174 color237 ~D

# ============
# header stuff
# ============
color hdrdefault color223 color237
color header     color223 color237 "^Subject"

# =========
# gpg stuff
# =========
color body       color188 color237 "^gpg: Good signature.*"
color body       color115 color236 "^gpg: BAD signature.*"
color body       color174 color237 "^gpg: Can't check signature.*"
color body       color174 color237 "^-----BEGIN PGP SIGNED MESSAGE-----"
color body       color174 color237 "^-----BEGIN PGP SIGNATURE-----"
color body       color174 color237 "^-----END PGP SIGNED MESSAGE-----"
color body       color174 color237 "^-----END PGP SIGNATURE-----"
color body       color174 color237 "^Version: GnuPG.*"
color body       color174 color237 "^Comment: .*"

# ========================
# url, email and web stuff
# ========================
color body       color174 color237 "(finger|ftp|http|https|news|telnet)://[^ >]*"
color body       color174 color237 "<URL:[^ ]*>"
color body       color174 color237 "www\\.[-.a-z0-9]+\\.[a-z][a-z][a-z]?([-_./~a-z0-9]+)?"
color body       color174 color237 "mailto: *[^ ]+\(\\i?subject=[^ ]+\)?"
color body       color174 color237 "[-a-z_0-9.%$]+@[-a-z_0-9.]+\\.[-a-z][-a-z]+"

# ===============
# misc body stuff
# ===============
color attachment color174 color237 # add-ons to the message
color signature  color223 color237

# ============
# quote levels
# ============
color quoted     color108 color237
color quoted1    color116 color237
color quoted2    color247 color237
color quoted3    color108 color237
color quoted4    color116 color237
color quoted5    color247 color237
color quoted6    color108 color237
color quoted7    color116 color237
color quoted8    color247 color237
color quoted9    color108 color237

